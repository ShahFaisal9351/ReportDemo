@model ReportDemo.Models.Student

@{
    ViewData["Title"] = "Add New Student";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<style>
    .create-form-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .form-header {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
        padding: 25px 30px;
        position: relative;
    }
    
    .form-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }
    
    @@keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .form-header-content {
        position: relative;
        z-index: 2;
    }
    
    .form-header h4 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .form-header p {
        margin: 8px 0 0 0;
        opacity: 0.9;
        font-size: 0.95rem;
    }
    
    .form-body {
        padding: 40px 30px;
    }
    
    .professional-input-group {
        margin-bottom: 25px;
    }
    
    .professional-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .professional-input {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 12px 16px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    .professional-input:focus {
        border-color: #27ae60;
        box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        background: #fff;
        outline: none;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }
    
    .professional-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        cursor: pointer;
    }
    
    .btn-save {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
    }
    
    .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        color: white;
    }
    
    .btn-cancel {
        background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        color: white;
    }
    
    .btn-cancel:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        color: white;
    }
    
    .validation-error {
        color: #e74c3c;
        font-size: 0.85rem;
        margin-top: 5px;
        display: block;
    }
    
    .input-icon {
        color: #7f8c8d;
    }
    
    .section-header {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .section-title {
        color: #2c3e50;
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }
    
    .input-group {
        display: flex;
        align-items: stretch;
    }
    
    .input-group .professional-input {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: none;
        flex: 1;
    }
    
    .input-group .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        border-left: 1px solid #e9ecef;
        padding: 12px 16px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    
    .input-group .btn:not(:last-child) {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: none;
    }
    
    .input-group .btn:hover {
        transform: none;
        box-shadow: none;
    }
    
    .loading-text {
        color: #6c757d;
        font-style: italic;
    }
</style>

<div class="create-form-container">
    <div class="form-header">
        <div class="form-header-content">
            <h4>
                <i class="fas fa-user-plus"></i>
                Add New Student
            </h4>
            <p>Enter student information to add them to the system</p>
        </div>
    </div>
    
    <div class="form-body">
        <form asp-action="Create" method="post">
            <!-- Personal Information Section -->
            <div class="section-header">
                <h5 class="section-title"><i class="fas fa-user me-2"></i>Personal Information</h5>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="FirstName" class="professional-label">
                            <i class="fas fa-user input-icon"></i>
                            First Name
                        </label>
                        <input asp-for="FirstName" class="form-control professional-input" 
                               placeholder="Enter first name" autocomplete="given-name" />
                        <span asp-validation-for="FirstName" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="LastName" class="professional-label">
                            <i class="fas fa-user input-icon"></i>
                            Last Name
                        </label>
                        <input asp-for="LastName" class="form-control professional-input" 
                               placeholder="Enter last name" autocomplete="family-name" />
                        <span asp-validation-for="LastName" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="Gender" class="professional-label">
                            <i class="fas fa-venus-mars input-icon"></i>
                            Gender
                        </label>
                        <select asp-for="Gender" class="form-control professional-input">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                        <span asp-validation-for="Gender" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="DateOfBirth" class="professional-label">
                            <i class="fas fa-calendar-alt input-icon"></i>
                            Date of Birth
                        </label>
                        <input asp-for="DateOfBirth" class="form-control professional-input" 
                               type="date" max="@DateTime.Today.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfBirth" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <!-- Academic Information Section -->
            <div class="section-header mt-4">
                <h5 class="section-title"><i class="fas fa-graduation-cap me-2"></i>Academic Information</h5>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="RollNumber" class="professional-label">
                            <i class="fas fa-id-card input-icon"></i>
                            Roll Number
                        </label>
                        <div class="input-group">
                            <input asp-for="RollNumber" class="form-control professional-input" 
                                   placeholder="Auto-generated or enter manually" readonly id="rollNumberInput" />
                            <button type="button" class="btn btn-outline-success" id="generateRollBtn" 
                                    title="Generate Roll Number" disabled>
                                <i class="fas fa-magic"></i>
                                Generate
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="editRollBtn" 
                                    title="Edit Manually">
                                <i class="fas fa-edit"></i>
                                Edit
                            </button>
                        </div>
                        <span asp-validation-for="RollNumber" class="validation-error"></span>
                        <small class="text-muted mt-1">Select a class first to auto-generate roll number</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="AdmissionNumber" class="professional-label">
                            <i class="fas fa-certificate input-icon"></i>
                            Admission Number
                        </label>
                        <input asp-for="AdmissionNumber" class="form-control professional-input" 
                               placeholder="Enter admission number" />
                        <span asp-validation-for="AdmissionNumber" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="ClassId" class="professional-label">
                            <i class="fas fa-chalkboard input-icon"></i>
                            Class
                        </label>
                        <select asp-for="ClassId" class="form-control professional-input">
                            <option value="">Select Class</option>
                            @if (ViewBag.Classes != null)
                            {
                                @foreach (var classItem in (List<ReportDemo.Models.Class>)ViewBag.Classes)
                                {
                                    <option value="@classItem.Id">@classItem.DisplayName</option>
                                }
                            }
                        </select>
                        <span asp-validation-for="ClassId" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="Section" class="professional-label">
                            <i class="fas fa-layer-group input-icon"></i>
                            Section
                        </label>
                        <select asp-for="Section" class="form-control professional-input">
                            <option value="">Select Section</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                            <option value="D">Section D</option>
                            <option value="E">Section E</option>
                        </select>
                        <span asp-validation-for="Section" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="MajorSubject" class="professional-label">
                            <i class="fas fa-book input-icon"></i>
                            Major Subject
                        </label>
                        <input asp-for="MajorSubject" class="form-control professional-input" 
                               placeholder="Enter major subject (optional)" />
                        <span asp-validation-for="MajorSubject" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="professional-input-group">
                <label asp-for="EnrollmentDate" class="professional-label">
                    <i class="fas fa-calendar-check input-icon"></i>
                    Enrollment Date
                </label>
                <input asp-for="EnrollmentDate" class="form-control professional-input" 
                       type="date" />
                <span asp-validation-for="EnrollmentDate" class="validation-error"></span>
            </div>
            
            <!-- Contact Information Section -->
            <div class="section-header mt-4">
                <h5 class="section-title"><i class="fas fa-envelope me-2"></i>Contact Information</h5>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="Email" class="professional-label">
                            <i class="fas fa-envelope input-icon"></i>
                            Email Address
                        </label>
                        <input asp-for="Email" class="form-control professional-input" 
                               placeholder="Enter email address" type="email" autocomplete="email" />
                        <span asp-validation-for="Email" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="PhoneNumber" class="professional-label">
                            <i class="fas fa-phone input-icon"></i>
                            Phone Number
                        </label>
                        <input asp-for="PhoneNumber" class="form-control professional-input" 
                               placeholder="Enter phone number" type="tel" autocomplete="tel" />
                        <span asp-validation-for="PhoneNumber" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <!-- Address Information Section -->
            <div class="section-header mt-4">
                <h5 class="section-title"><i class="fas fa-map-marker-alt me-2"></i>Address Information</h5>
            </div>
            
            <div class="professional-input-group">
                <label asp-for="Address" class="professional-label">
                    <i class="fas fa-home input-icon"></i>
                    Address
                </label>
                <textarea asp-for="Address" class="form-control professional-input" 
                          placeholder="Enter full address" rows="3"></textarea>
                <span asp-validation-for="Address" class="validation-error"></span>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="City" class="professional-label">
                            <i class="fas fa-city input-icon"></i>
                            City
                        </label>
                        <input asp-for="City" class="form-control professional-input" 
                               placeholder="Enter city" />
                        <span asp-validation-for="City" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="Country" class="professional-label">
                            <i class="fas fa-globe input-icon"></i>
                            Country
                        </label>
                        <input asp-for="Country" class="form-control professional-input" 
                               placeholder="Enter country" />
                        <span asp-validation-for="Country" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <!-- Guardian Information Section -->
            <div class="section-header mt-4">
                <h5 class="section-title"><i class="fas fa-users me-2"></i>Guardian Information</h5>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="GuardianName" class="professional-label">
                            <i class="fas fa-user-shield input-icon"></i>
                            Primary Guardian Name
                        </label>
                        <input asp-for="GuardianName" class="form-control professional-input" 
                               placeholder="Enter primary guardian's full name" />
                        <span asp-validation-for="GuardianName" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="GuardianContact" class="professional-label">
                            <i class="fas fa-phone-alt input-icon"></i>
                            Guardian Contact
                        </label>
                        <input asp-for="GuardianContact" class="form-control professional-input" 
                               placeholder="Enter guardian's contact number" type="tel" />
                        <span asp-validation-for="GuardianContact" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="FatherName" class="professional-label">
                            <i class="fas fa-male input-icon"></i>
                            Father Name (Optional)
                        </label>
                        <input asp-for="FatherName" class="form-control professional-input" 
                               placeholder="Enter father's name" />
                        <span asp-validation-for="FatherName" class="validation-error"></span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="professional-input-group">
                        <label asp-for="MotherName" class="professional-label">
                            <i class="fas fa-female input-icon"></i>
                            Mother Name (Optional)
                        </label>
                        <input asp-for="MotherName" class="form-control professional-input" 
                               placeholder="Enter mother's name" />
                        <span asp-validation-for="MotherName" class="validation-error"></span>
                    </div>
                </div>
            </div>
            
            <div class="professional-input-group">
                <label asp-for="EmergencyContact" class="professional-label">
                    <i class="fas fa-exclamation-triangle input-icon"></i>
                    Emergency Contact (Optional)
                </label>
                <input asp-for="EmergencyContact" class="form-control professional-input" 
                       placeholder="Enter emergency contact number" type="tel" />
                <span asp-validation-for="EmergencyContact" class="validation-error"></span>
            </div>

            <div class="form-actions">
                <a asp-action="Index" class="professional-btn btn-cancel">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="submit" class="professional-btn btn-save">
                    <i class="fas fa-save"></i>
                    Save Student
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        $(document).ready(function() {
            // Enable/disable generate button based on class selection
            $('#ClassId').on('change', function() {
                var classId = $(this).val();
                var generateBtn = $('#generateRollBtn');
                var rollNumberInput = $('#rollNumberInput');
                
                if (classId && classId !== '') {
                    generateBtn.prop('disabled', false);
                    
                    // Auto-generate roll number when class is selected
                    if (rollNumberInput.val() === '' || rollNumberInput.hasClass('auto-generated')) {
                        generateRollNumber();
                    }
                } else {
                    generateBtn.prop('disabled', true);
                    if (rollNumberInput.hasClass('auto-generated')) {
                        rollNumberInput.val('');
                        rollNumberInput.removeClass('auto-generated');
                    }
                }
            });
            
            // Generate roll number button click
            $('#generateRollBtn').on('click', function() {
                generateRollNumber();
            });
            
            // Edit roll number manually
            $('#editRollBtn').on('click', function() {
                var rollNumberInput = $('#rollNumberInput');
                var editBtn = $(this);
                
                if (rollNumberInput.prop('readonly')) {
                    rollNumberInput.prop('readonly', false);
                    rollNumberInput.removeClass('auto-generated');
                    rollNumberInput.focus();
                    editBtn.html('<i class="fas fa-lock"></i> Lock');
                    editBtn.removeClass('btn-outline-secondary').addClass('btn-outline-warning');
                    editBtn.attr('title', 'Lock to prevent changes');
                } else {
                    rollNumberInput.prop('readonly', true);
                    editBtn.html('<i class="fas fa-edit"></i> Edit');
                    editBtn.removeClass('btn-outline-warning').addClass('btn-outline-secondary');
                    editBtn.attr('title', 'Edit Manually');
                }
            });
            
            function generateRollNumber() {
                var classId = $('#ClassId').val();
                var generateBtn = $('#generateRollBtn');
                var rollNumberInput = $('#rollNumberInput');
                
                if (!classId || classId === '') {
                    alert('Please select a class first.');
                    return;
                }
                
                // Show loading state
                generateBtn.prop('disabled', true);
                var originalText = generateBtn.html();
                generateBtn.html('<i class="fas fa-spinner fa-spin"></i> Generating...');
                rollNumberInput.val('Generating...').addClass('loading-text');
                
                // Make AJAX request to generate roll number
                $.ajax({
                    url: '@Url.Action("GenerateRollNumber", "Students")',
                    type: 'POST',
                    data: {
                        classId: classId,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            rollNumberInput.val(response.rollNumber);
                            rollNumberInput.addClass('auto-generated');
                            rollNumberInput.removeClass('loading-text');
                            rollNumberInput.prop('readonly', true);
                            
                            // Show success feedback
                            showNotification('Roll number generated successfully!', 'success');
                        } else {
                            rollNumberInput.val('');
                            rollNumberInput.removeClass('loading-text');
                            showNotification('Error: ' + response.error, 'error');
                        }
                    },
                    error: function() {
                        rollNumberInput.val('');
                        rollNumberInput.removeClass('loading-text');
                        showNotification('An error occurred while generating roll number.', 'error');
                    },
                    complete: function() {
                        // Restore button state
                        generateBtn.html(originalText);
                        generateBtn.prop('disabled', false);
                    }
                });
            }
            
            function showNotification(message, type) {
                var alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
                var icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
                
                var notification = $(`
                    <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
                         style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                        <i class="${icon}"></i> ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `);
                
                $('body').append(notification);
                
                // Auto-hide after 5 seconds
                setTimeout(function() {
                    notification.alert('close');
                }, 5000);
            }
        });
    </script>
}
